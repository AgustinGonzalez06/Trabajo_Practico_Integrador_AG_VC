<!DOCTYPE html>
<html lang="es">
  <%- include('../Partials/header', { titulo: 'Dashboard Admin' }) %>
<body>

  <main>
    <a
      class="dashboard-search-container btn-agregar"
      style="max-width: 480px; margin: 10px auto; text-decoration: none;"
      href="/admin/agregar"
    >
      <span>â•</span>
    </a>

    <a href="/admin/ventas">ğŸ“„ Ver todas las ventas</a>

    <div
      class="dashboard-search-container"
      style="max-width: 480px; margin: 10px auto;"
    >
      <input
        type="text"
        id="dashboard-search-bar"
        placeholder="Buscar producto..."
        style="width: 100%; padding: 8px 12px; font-size: 16px; border-radius: 8px; border: 1px solid #ccc;"
      />
    </div>

    <% if (productos && productos.length > 0) { %>
      <section class="product-grid">
        <% productos.forEach(producto => { %>
          <div class="product-card">
            <img src="<%= producto.img %>" alt="<%= producto.nombre %>" />
            <h3><%= producto.nombre %></h3>
            <p>ğŸ’° Precio: $<%= producto.precio %></p>
            <p>ğŸ“‚ CategorÃ­a: <%= producto.categoria %></p>
            <p>ğŸ·ï¸ SubcategorÃ­a: <%= producto.subcategoria %></p>
            <p><%= producto.activo ? "ğŸŸ¢ Activo" : "ğŸ”´ Inactivo" %></p>

            <div class="acciones">
              <a href="/admin/editar/<%= producto.id %>" class="btn-editar">Editar</a>
              <form
                action="/admin/toggle-estado/<%= producto.id %>"
                method="POST"
                style="display:inline;"
                onsubmit="return confirm('Â¿EstÃ¡s seguro de cambiar el estado de este producto?');"
              >
                <button type="submit" class="btn-deshabilitar">
                  <%= producto.activo ? " Deshabilitar" : " Habilitar" %>
                </button>
              </form>
            </div>
          </div>
        <% }); %>
      </section>
    <% } else { %>
      <p>No hay productos cargados.</p>
    <% } %>
  </main>

  <%- include('../Partials/footer') %>
  <%- include('../Partials/scripts') %>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const searchBar = document.getElementById('dashboard-search-bar');
      const productCards = document.querySelectorAll('.product-card');

      searchBar.addEventListener('input', () => {
        const texto = searchBar.value.toLowerCase();

        if (texto.length < 3) {
          productCards.forEach(card => {
            card.style.display = '';
          });
          return;
        }

        productCards.forEach(card => {
          const nombre = card.querySelector('h3').textContent.toLowerCase();
          if (nombre.includes(texto)) {
            card.style.display = '';
          } else {
            card.style.display = 'none';
          }
        });
      });
    });
  </script>
</body>
</html>
